---
// Odczytujemy parametr 'simulatedAuth' z URL
const simulatedAuthParam = Astro.url.searchParams.get('simulatedAuth');

// Ustawiamy isAuthenticated na podstawie parametru URL
// Jeśli parametr nie istnieje lub ma inną wartość niż 'true', użytkownik jest wylogowany
let isAuthenticated = simulatedAuthParam === 'true';

// Pozostałe zamockowane dane, user jest potrzebny, gdy isAuthenticated jest true
const user = isAuthenticated ? { name: "MockUser" } : null;
const isAdmin = isAuthenticated ? false : false; // Można też sterować isAdmin przez URL jeśli potrzeba
---

<nav class="bg-gray-800 text-white p-4">
  <div class="container mx-auto flex justify-between items-center">
    <div class="text-lg font-bold">
      <a href="/">10x Cards</a>
    </div>

    {/* Desktop Menu - hidden on small screens */}
    <div class="hidden md:flex items-center space-x-1">
      {
        !isAuthenticated && (
          <>
            <a href={`${Astro.url.pathname}?simulatedAuth=true`} class="px-3 py-2 rounded hover:bg-gray-700">Zaloguj się</a>
            <a href="/register" class="px-3 py-2 rounded hover:bg-gray-700">Zarejestruj się</a>
          </>
        )
      }
      {
        isAuthenticated && user && (
          <>
            <a href="/" class="px-3 py-2 rounded hover:bg-gray-700">Strona główna</a>
            <a href="/generate" class="px-3 py-2 rounded hover:bg-gray-700">Generuj fiszki</a>
            <a href="/flashcards" class="px-3 py-2 rounded hover:bg-gray-700">Moje fiszki</a>
            <a href="/sessions/new" class="px-3 py-2 rounded hover:bg-gray-700">Nauka</a>
            <a href="/profile" class="px-3 py-2 rounded hover:bg-gray-700 cursor-not-allowed" title="Wkrótce">
              Profil
            </a>
            {isAdmin && (
              <a href="/admin/metrics" class="px-3 py-2 rounded hover:bg-gray-700">
                Panel admina
              </a>
            )}
            <span class="px-3 py-2">Witaj, {user.name}</span>
            <a href={`${Astro.url.pathname}?simulatedAuth=false`} class="px-3 py-2 rounded hover:bg-gray-700">Wyloguj się</a>
          </>
        )
      }
    </div>

    {/* Mobile Menu Button - visible on small screens */}
    <div class="md:hidden">
      <button id="mobile-menu-button" aria-label="Otwórz menu" class="text-white focus:outline-none hover:text-gray-300">
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7"></path>
        </svg>
      </button>
    </div>
  </div>

  {/* Mobile Menu - hidden by default, shown on mobile when active (JS later) */}
  <div id="mobile-menu" class="hidden md:hidden">
    <div class="px-2 pt-2 pb-3 space-y-1 sm:px-3">
      {
        !isAuthenticated && (
          <>
            <a href={`${Astro.url.pathname}?simulatedAuth=true`} class="block px-3 py-2 rounded hover:bg-gray-700">Zaloguj się</a>
            <a href="/register" class="block px-3 py-2 rounded hover:bg-gray-700">Zarejestruj się</a>
          </>
        )
      }
      {
        isAuthenticated && user && (
          <>
            <a href="/" class="block px-3 py-2 rounded hover:bg-gray-700">Strona główna</a>
            <a href="/generate" class="block px-3 py-2 rounded hover:bg-gray-700">Generuj fiszki</a>
            <a href="/flashcards" class="block px-3 py-2 rounded hover:bg-gray-700">Moje fiszki</a>
            <a href="/sessions/new" class="block px-3 py-2 rounded hover:bg-gray-700">Nauka</a>
            <a href="/profile" class="block px-3 py-2 rounded hover:bg-gray-700 cursor-not-allowed" title="Wkrótce">
              Profil
            </a>
            {isAdmin && (
              <a href="/admin/metrics" class="block px-3 py-2 rounded hover:bg-gray-700">
                Panel admina
              </a>
            )}
            <span class="block px-3 py-2">Witaj, {user.name}</span>
            <a href={`${Astro.url.pathname}?simulatedAuth=false`} class="block px-3 py-2 rounded hover:bg-gray-700">Wyloguj się</a>
          </>
        )
      }
    </div>
  </div>
</nav>

<script>
  // Placeholder for client-side script to toggle mobile menu visibility.
  const mobileMenuButton = document.getElementById('mobile-menu-button');
  const mobileMenu = document.getElementById('mobile-menu');
  mobileMenuButton?.addEventListener('click', () => {
    mobileMenu?.classList.toggle('hidden');
  });
</script>

<!-- TODO: Implement mobile hamburger menu --> 